<!DOCTYPE html>
<html lang="en">

<head>
    <title>Python Flask Materials App</title>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="/tifun-data-explorer/static/scripts/data-explorer.js"></script>
    <link rel="stylesheet" type="text/css" href="/tifun-data-explorer/static/styles/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link rel="icon" type="image/png" href="/tifun-data-explorer/static/icon.png" sizes="32x32">

</head>
<body>

<div class="container">

<header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
            <img class="bi me-2" height=40 width=40 src="/tifun-data-explorer/static/logo_small.png" alt="Lightform logo">
            <span class="fs-4">TiFun Materials Database</span>
        </a>
        <ul class="nav nav-pills">

                <li class="nav-item"><a href="/tifun-data-explorer/"
                                        class="nav-link">Home</a>
                </li>
                <li class="nav-item"><a href="/tifun-data-explorer/samples/"
                                        class="nav-link active">Samples</a>
                </li>
                <li class="nav-item"><a href="/tifun-data-explorer/experiments/"
                                        class="nav-link">Experiments</a>
                </li>
                <li class="nav-item"><a href="/tifun-data-explorer/about.html"
                                        class="nav-link">About</a>
                </li>
        </ul>
    </header>
</div>

<div class="alert_banner">
</div>

<div class="container">
    <div class="container">
        <div class="row">
            <div class="col-6">
                <h2>Samples</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-6 my-3">
                <select name="sample_selection" class="form-select my-3" aria-label="Sample selection"
                        onchange="this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value);">
                        <option value="/tifun-data-explorer/samples/Nick%27s%20Forged%20Block.html">Nick&#39;s Forged Block</option>
                        <option value="/tifun-data-explorer/samples/TIMET-A.html">TIMET-A</option>
                        <option value="/tifun-data-explorer/samples/TIMET-B.html">TIMET-B</option>
                        <option value="/tifun-data-explorer/samples/TIMET-C.html">TIMET-C</option>
                        <option value="/tifun-data-explorer/samples/TIMET-A-C.html">TIMET-A-C</option>
                        <option value="/tifun-data-explorer/samples/TIMET-B-4.html">TIMET-B-4</option>
                        <option value="/tifun-data-explorer/samples/TIMET-A-MR-0.html">TIMET-A-MR-0</option>
                        <option value="/tifun-data-explorer/samples/TIMET-A-MR-45.html">TIMET-A-MR-45</option>
                        <option value="/tifun-data-explorer/samples/TIMET-A-MR-90.html">TIMET-A-MR-90</option>
                        <option value="/tifun-data-explorer/samples/TIMET-A-S-0.html">TIMET-A-S-0</option>
                        <option value="/tifun-data-explorer/samples/TIMET-A-S-45.html">TIMET-A-S-45</option>
                        <option value="/tifun-data-explorer/samples/TIMET-A-S-90.html">TIMET-A-S-90</option>
                        <option value="/tifun-data-explorer/samples/TIMET-B-825C-50red.html">TIMET-B-825C-50red</option>
                        <option value="/tifun-data-explorer/samples/TIMET-B-825C-75red.html">TIMET-B-825C-75red</option>
                        <option value="/tifun-data-explorer/samples/TIMET-B-825C-875red.html" selected="selected">TIMET-B-825C-875red</option>
                </select>
                <div id="sample_details" class="my-3">
                    <h3>Sample Details</h3>
                    Sample Name: TIMET-B-825C-875red<br>
                    Sample creation method: Forging<br>
                    Sample creation details: None<br>
                </div>
                <div id="sample_images" class="row my-4">
                    <div class="col">
                        <h3>Sample Images</h3>
                    </div>
                </div>
                    Sample has no images.
                    <div id="child_samples" class="my-3">
                        <h3>Child samples</h3>
                            Sample has no child samples.
                    </div>

                <div id="sample_experiments" class="my-4">
                    <h3>Measurements</h3>
                        Sample has no measurements.
                </div>

            </div>

            <div class="col-6 my-3 ml-3">
                <div class="row text-center">
                    <h3>Sample relationships</h3>
                </div>
                <div class="row" id="graph-container"></div>
            </div>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.19.1/cytoscape.min.js"></script>
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.js"></script>
    <script src="/tifun-data-explorer/static/scripts/cytoscape-dagre.js"></script>
    <script src="/tifun-data-explorer/static/scripts/cytoscape_canvas.js"></script>
    <script src="/tifun-data-explorer/static/scripts/network-graph.js"></script>

    <script>

        var cy = cytoscape({
            pixelRatio: '1',
            container: document.getElementById('graph-container'), // container to render in

            elements: [
                {data: {id: 'TIMET-B-825C-875red', href: '/tifun-data-explorer/samples/TIMET-B-825C-875red.html'}, 'classes': 'current_sample'},
                    {data: {id: 'TIMET-B-825C-75red', href: '/tifun-data-explorer/samples/TIMET-B-825C-75red.html'}, 'classes': 'parent'},

                    {'data': {'id': 'TIMET-B-825C-75red-TIMET-B-825C-875red', 'source': 'TIMET-B-825C-75red',
                                'target': 'TIMET-B-825C-875red'}, 'classes': 'Forging' },
            ],

            style: [ // the stylesheet for the graph
                {
                    selector: 'node',
                    style: {
                        'background-color': '#666',
                        'label': 'data(id)',
                        'font-size': 20
                    }
                },

                {
                    selector: '.current_sample',
                    style: {
                        'background-color': '#7cc95d'
                    }
                },

                {
                    selector: '.parent',
                    style: {
                        'background-color': '#c95d5d'
                    }
                },

                {
                    selector: '.child',
                    style: {
                        'background-color': '#5d98c9'
                    }
                },

                {
                    selector: 'edge',
                    style: {
                        'width': 3,
                        'line-color': 'grey',
                        'target-arrow-color': 'grey',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier'
                    }
                },

                {
                    selector: '.Unknown',
                    style: {
                        'line-color': 'grey',
                        'target-arrow-color': 'grey',
                    }
                },
                {
                    selector: '.Forging',
                    style: {
                        'line-color': 'red',
                        'target-arrow-color': 'red',
                    }
                },
                {
                    selector: '.Rolling',
                    style: {
                        'line-color': 'green',
                        'target-arrow-color': 'green',
                    }
                },
                {
                    selector: '.Cutting',
                    style: {
                        'line-color': 'blue',
                        'target-arrow-color': 'blue',
                    }
                },
            ],

                layout: {
                    name: 'dagre',
                    spacingFactor: 1.5
                }

        });

        cy.on('tap', 'node', function () {
            if (this.data('href') !== undefined) {
                window.location.href = this.data('href');
            }
        });

        // Draw a legend on a separate canvas over the graph
        let bottomLayer = cy.cyCanvas({
            zIndex: -1
        });
        let canvas = bottomLayer.getCanvas();
        let ctx = canvas.getContext("2d");

        var legend_scale = 0.2
        var canvas_top
        var left
        var right
        var width
        var height
        var legend_left
        var legend_spacing
        var font_size
        var line_width
        var line_padding
        const node_types = [{"colour": "#7cc95d", "name": "Current"}, {"colour": "#c95d5d", "name": "Parent"}, {"colour": "#5d98c9", "name": "Child"}]
        const methods = [{"colour": "grey", "name": "Unknown"}, {"colour": "red", "name": "Forging"}, {"colour": "green", "name": "Rolling"}, {"colour": "blue", "name": "Cutting"}]
        function canvas_resize() {
            clear_canvas(bottomLayer, ctx)
            update_variables(cy)
            render_node_legend(ctx)
            render_edge_legend(ctx)
        }

        cy.on("render cyCanvas.resize", canvas_resize)

    </script>


</div>

</body>

</html>